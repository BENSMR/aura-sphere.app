# ğŸ¯ Quick Reference - Testing AuraSphere Pro

## Before You Start

```bash
# 1. Set OpenAI API key (REQUIRED)
firebase functions:config:set openai.key="sk-YOUR-KEY-HERE"

# 2. Verify it's set
firebase functions:config:get
# Should show: openai.key = "sk-..."

# 3. Monitor logs during testing
firebase functions:log --follow
```

---

## Test Flow (5 minutes)

### 1. Launch App
```bash
flutter run
```

### 2. Navigate to CRM Screen
- Login with test credentials
- Tap "CRM" card from dashboard

### 3. Generate Insights
- Select 2-3 contacts
- Tap "Generate Insights"
- Wait 10-30 seconds

### 4. Check Results

**In App:**
- Insights appear with actions
- Shows source: "openai" or "cache"

**In Firebase Console:**
1. Firestore â†’ users/{your-uid}/tasks
2. Filter: `autoGenerated == true`
3. Should see 2-5 task documents

**In App Tasks Screen:**
1. Tap "Tasks" from dashboard
2. Should see new tasks immediately
3. Each shows ğŸ“± icon, title, channel, due date

---

## Verification Checklist

- [ ] Insights appear in CRM screen (10-30s)
- [ ] Tasks in Firestore with userId field
- [ ] Tasks appear in TasksListScreen
- [ ] ğŸ“± icon visible (auto-generated)
- [ ] All required fields present:
  - [ ] id
  - [ ] userId (security requirement)
  - [ ] title
  - [ ] channel (email/call/sms)
  - [ ] status (pending)
  - [ ] dueAt (timestamp)
  - [ ] autoGenerated (true)
  - [ ] sourceInsightId

---

## What Should Work

| Feature | Expected | Status |
|---------|----------|--------|
| CRM insights generation | 10-30 sec response | âœ… |
| Task auto-creation | 2-5 tasks created | âœ… |
| Real-time display | Tasks appear instantly | âœ… |
| Task details | All fields populated | âœ… |
| Caching (3-hour) | 2nd request instant | âœ… |
| Reminders (5-min) | Queue entries created | âœ… |

---

## Troubleshooting

### Tasks don't appear in TasksListScreen
```bash
# Check provider is registered
grep "TaskProvider" lib/app/app.dart

# Check Firestore query
grep "where('status'" lib/services/firebase/task_service.dart

# Check stream subscription
firebase functions:log | grep "streamMyTasks"
```

### Insights generation fails
```bash
# Check OpenAI key
firebase functions:config:get

# Check function logs
firebase functions:log --limit 50

# Look for "OpenAI API failed" errors
```

### Firestore writes rejected
```bash
# Check security rules
firebase rules:list firestore

# Verify userId field on documents
# Rule: allow read, write: if request.auth.uid == userId;
```

---

## Key Files

```
lib/
â”œâ”€â”€ screens/crm/crm_screen.dart           # Insights UI
â”œâ”€â”€ screens/tasks/tasks_list_screen.dart  # Task list UI
â”œâ”€â”€ providers/crm_insights_provider.dart  # Insights state
â”œâ”€â”€ providers/task_provider.dart          # Tasks state
â””â”€â”€ services/ai/openai_crm_service.dart   # CloudFunctions caller

functions/src/
â”œâ”€â”€ crm/insights.ts                       # AI function
â””â”€â”€ tasks/processDueReminders.ts          # Scheduler function

Firestore collections:
â”œâ”€â”€ users/{uid}/tasks                     # Auto-created tasks
â”œâ”€â”€ users/{uid}/crm_insights              # AI insights
â””â”€â”€ task_queue                            # Reminder queue
```

---

## Documentation

- **TESTING_GUIDE.md** â€” Detailed step-by-step guide
- **TEST_VERIFICATION.md** â€” Technical verification
- **INTEGRATION_COMPLETE.md** â€” Complete data flow
- **DEPLOYMENT_CHECKLIST.md** â€” Status verification
- **crm_insights_fix_guide.md** â€” Solution details

---

## Success Criteria

âœ… **All of these should be true:**

1. **CRM Insights Generated**
   - Response appears in 10-30 seconds
   - Source shows "openai" or "cache"
   - Actions listed with titles and channels

2. **Tasks Auto-Created**
   - 2-5 tasks appear in Firestore
   - Each has userId field (required)
   - status = "pending"
   - autoGenerated = true

3. **Tasks Display in App**
   - TasksListScreen shows all tasks
   - ğŸ“± icon visible for AI tasks
   - Title, channel, due date visible
   - Updates in real-time

4. **Reminders Process**
   - Every 5 minutes: processDueReminders runs
   - task_queue collection has entries
   - Status shows "ready_to_send"

---

## Quick Commands

```bash
# Deploy functions
firebase deploy --only functions

# Monitor logs
firebase functions:log --follow

# Set OpenAI key
firebase functions:config:set openai.key="sk-..."

# Check config
firebase functions:config:get

# Run app
flutter run

# Check errors
flutter analyze

# View Firestore
firebase firestore:inspect
```

---

## Expected Data Structure

### Task Document
```json
{
  "id": "task_abc123",
  "userId": "user_123",
  "title": "Email John about Q4 proposal",
  "description": "Follow up discussion",
  "channel": "email",
  "status": "pending",
  "autoGenerated": true,
  "sourceInsightId": "insight_xyz789",
  "createdAt": Timestamp(2025-11-26T14:30:00Z),
  "dueAt": Timestamp(2025-11-28T14:30:00Z),
  "remindAt": Timestamp(2025-11-28T14:30:00Z),
  "assignedTo": "user_123"
}
```

---

## Next Steps After Testing

1. âœ… **Tests pass?**
   - Enable feature flag
   - Deploy to production
   - Monitor logs

2. âŒ **Tests fail?**
   - Check firebase functions:log
   - Verify OpenAI key is set
   - Check Firestore security rules
   - See TESTING_GUIDE.md troubleshooting

---

**Status:** âœ… READY FOR TESTING

Set the OpenAI API key and run tests!
