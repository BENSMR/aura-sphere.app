import 'package:pdf/widgets.dart' as pw;
import 'package:pdf/pdf.dart';
import 'package:intl/intl.dart';
import '../../data/models/invoice_model.dart';

/// Classic template - traditional professional design
/// Full featured with all business details
class InvoiceTemplateClassic {
  /// Build classic invoice PDF page
  static List<pw.Widget> build(
    pw.Context context,
    InvoiceModel invoice,
    Map<String, dynamic> business,
    PdfColor brandColor,
  ) {
    final currency = invoice.currency.toUpperCase();
    final df = DateFormat.yMMMd();

    return [
      // Header with business info
      pw.Row(
        mainAxisAlignment: pw.MainAxisAlignment.spaceBetween,
        children: [
          pw.Column(
            crossAxisAlignment: pw.CrossAxisAlignment.start,
            children: [
              pw.Text(
                business['businessName'] ?? 'Business Name',
                style: pw.TextStyle(
                  fontSize: 22,
                  fontWeight: pw.FontWeight.bold,
                  color: brandColor,
                ),
              ),
              if (business['address'] != null)
                pw.Text(
                  business['address'] as String,
                  style: const pw.TextStyle(fontSize: 10),
                ),
              if (business['phone'] != null)
                pw.Text(
                  'Phone: ${business['phone'] as String}',
                  style: const pw.TextStyle(fontSize: 10),
                ),
            ],
          ),
          pw.Column(
            crossAxisAlignment: pw.CrossAxisAlignment.end,
            children: [
              pw.Text(
                'INVOICE',
                style: pw.TextStyle(
                  fontSize: 28,
                  fontWeight: pw.FontWeight.bold,
                  color: brandColor,
                ),
              ),
              pw.SizedBox(height: 4),
              pw.Text(
                '#${invoice.invoiceNumber}',
                style: pw.TextStyle(fontSize: 14, fontWeight: pw.FontWeight.bold),
              ),
            ],
          ),
        ],
      ),
      pw.SizedBox(height: 20),
      pw.Divider(color: brandColor, thickness: 2),
      pw.SizedBox(height: 16),

      // Invoice details row
      pw.Row(
        mainAxisAlignment: pw.MainAxisAlignment.spaceBetween,
        children: [
          pw.Column(
            crossAxisAlignment: pw.CrossAxisAlignment.start,
            children: [
              pw.Text(
                'Invoice Date',
                style: pw.TextStyle(fontSize: 11, fontWeight: pw.FontWeight.bold),
              ),
              pw.Text(
                df.format(invoice.createdAt.toDate()),
                style: const pw.TextStyle(fontSize: 12),
              ),
            ],
          ),
          pw.Column(
            crossAxisAlignment: pw.CrossAxisAlignment.start,
            children: [
              pw.Text(
                'Due Date',
                style: pw.TextStyle(fontSize: 11, fontWeight: pw.FontWeight.bold),
              ),
              pw.Text(
                invoice.dueDate != null
                    ? df.format(invoice.dueDate!)
                    : 'N/A',
                style: const pw.TextStyle(fontSize: 12),
              ),
            ],
          ),
          pw.Column(
            crossAxisAlignment: pw.CrossAxisAlignment.start,
            children: [
              pw.Text(
                'Currency',
                style: pw.TextStyle(fontSize: 11, fontWeight: pw.FontWeight.bold),
              ),
              pw.Text(currency, style: const pw.TextStyle(fontSize: 12)),
            ],
          ),
        ],
      ),
      pw.SizedBox(height: 16),

      // Bill To section
      pw.Column(
        crossAxisAlignment: pw.CrossAxisAlignment.start,
        children: [
          pw.Text(
            'BILL TO',
            style: pw.TextStyle(
              fontSize: 12,
              fontWeight: pw.FontWeight.bold,
              color: brandColor,
            ),
          ),
          pw.SizedBox(height: 8),
          pw.Container(
            padding: const pw.EdgeInsets.all(12),
            decoration: pw.BoxDecoration(
              border: pw.Border.all(color: PdfColors.grey300),
            ),
            child: pw.Column(
              crossAxisAlignment: pw.CrossAxisAlignment.start,
              children: [
                pw.Text(
                  invoice.clientName,
                  style: pw.TextStyle(
                    fontSize: 12,
                    fontWeight: pw.FontWeight.bold,
                  ),
                ),
                pw.Text(invoice.clientEmail, style: const pw.TextStyle(fontSize: 10)),
              ],
            ),
          ),
        ],
      ),
      pw.SizedBox(height: 20),

      // Items table - full featured
      pw.Table(
        border: pw.TableBorder.all(color: PdfColors.grey400, width: 1),
        columnWidths: {
          0: const pw.FlexColumnWidth(3),
          1: const pw.FlexColumnWidth(1),
          2: const pw.FlexColumnWidth(1.2),
          3: const pw.FlexColumnWidth(1.2),
        },
        children: [
          // Header row
          pw.TableRow(
            decoration: pw.BoxDecoration(color: brandColor.withOpacity(0.15)),
            children: [
              pw.Padding(
                padding: const pw.EdgeInsets.all(8),
                child: pw.Text(
                  'Description',
                  style: pw.TextStyle(fontWeight: pw.FontWeight.bold, fontSize: 11),
                ),
              ),
              pw.Padding(
                padding: const pw.EdgeInsets.all(8),
                child: pw.Text(
                  'Qty',
                  style: pw.TextStyle(fontWeight: pw.FontWeight.bold, fontSize: 11),
                  textAlign: pw.TextAlign.center,
                ),
              ),
              pw.Padding(
                padding: const pw.EdgeInsets.all(8),
                child: pw.Text(
                  'Unit Price',
                  style: pw.TextStyle(fontWeight: pw.FontWeight.bold, fontSize: 11),
                  textAlign: pw.TextAlign.right,
                ),
              ),
              pw.Padding(
                padding: const pw.EdgeInsets.all(8),
                child: pw.Text(
                  'Total',
                  style: pw.TextStyle(fontWeight: pw.FontWeight.bold, fontSize: 11),
                  textAlign: pw.TextAlign.right,
                ),
              ),
            ],
          ),
          // Item rows
          ...invoice.items.asMap().entries.map((entry) {
            final item = entry.value;
            final isAlternate = entry.key % 2 == 0;
            return pw.TableRow(
              decoration: isAlternate
                  ? pw.BoxDecoration(color: PdfColors.grey100)
                  : null,
              children: [
                pw.Padding(
                  padding: const pw.EdgeInsets.all(8),
                  child: pw.Text(item.description, fontSize: 11),
                ),
                pw.Padding(
                  padding: const pw.EdgeInsets.all(8),
                  child: pw.Text(
                    item.quantity.toString(),
                    textAlign: pw.TextAlign.center,
                    fontSize: 11,
                  ),
                ),
                pw.Padding(
                  padding: const pw.EdgeInsets.all(8),
                  child: pw.Text(
                    '${item.unitPrice.toStringAsFixed(2)}',
                    textAlign: pw.TextAlign.right,
                    fontSize: 11,
                  ),
                ),
                pw.Padding(
                  padding: const pw.EdgeInsets.all(8),
                  child: pw.Text(
                    '${item.total.toStringAsFixed(2)}',
                    textAlign: pw.TextAlign.right,
                    fontSize: 11,
                  ),
                ),
              ],
            );
          }),
        ],
      ),
      pw.SizedBox(height: 16),

      // Totals section
      pw.Row(
        mainAxisAlignment: pw.MainAxisAlignment.end,
        children: [
          pw.Column(
            crossAxisAlignment: pw.CrossAxisAlignment.end,
            children: [
              pw.Row(
                mainAxisAlignment: pw.MainAxisAlignment.spaceBetween,
                children: [
                  pw.Text('Subtotal:', fontSize: 11),
                  pw.SizedBox(width: 60),
                  pw.Text(
                    '${invoice.subtotal.toStringAsFixed(2)} $currency',
                    textAlign: pw.TextAlign.right,
                    fontSize: 11,
                  ),
                ],
              ),
              if (invoice.taxRate > 0)
                pw.Row(
                  mainAxisAlignment: pw.MainAxisAlignment.spaceBetween,
                  children: [
                    pw.Text(
                      'Tax (${(invoice.taxRate * 100).toStringAsFixed(0)}%):',
                      fontSize: 11,
                    ),
                    pw.SizedBox(width: 60),
                    pw.Text(
                      '${invoice.tax.toStringAsFixed(2)} $currency',
                      textAlign: pw.TextAlign.right,
                      fontSize: 11,
                    ),
                  ],
                ),
              if (invoice.discount > 0)
                pw.Row(
                  mainAxisAlignment: pw.MainAxisAlignment.spaceBetween,
                  children: [
                    pw.Text('Discount:', fontSize: 11),
                    pw.SizedBox(width: 60),
                    pw.Text(
                      '-${invoice.discount.toStringAsFixed(2)} $currency',
                      textAlign: pw.TextAlign.right,
                      fontSize: 11,
                    ),
                  ],
                ),
              pw.SizedBox(height: 8),
              pw.Container(
                padding: const pw.EdgeInsets.symmetric(horizontal: 12, vertical: 8),
                decoration: pw.BoxDecoration(
                  color: brandColor.withOpacity(0.15),
                  border: pw.Border.all(color: brandColor, width: 2),
                ),
                child: pw.Row(
                  mainAxisAlignment: pw.MainAxisAlignment.spaceBetween,
                  children: [
                    pw.Text(
                      'TOTAL:',
                      style: pw.TextStyle(
                        fontSize: 14,
                        fontWeight: pw.FontWeight.bold,
                        color: brandColor,
                      ),
                    ),
                    pw.SizedBox(width: 20),
                    pw.Text(
                      '${invoice.total.toStringAsFixed(2)} $currency',
                      style: pw.TextStyle(
                        fontSize: 14,
                        fontWeight: pw.FontWeight.bold,
                        color: brandColor,
                      ),
                      textAlign: pw.TextAlign.right,
                    ),
                  ],
                ),
              ),
            ],
          ),
        ],
      ),
      pw.SizedBox(height: 16),

      // Notes section
      if ((invoice.notes ?? '').isNotEmpty) ...[
        pw.Divider(color: PdfColors.grey300),
        pw.SizedBox(height: 8),
        pw.Text(
          'Notes',
          style: pw.TextStyle(fontSize: 11, fontWeight: pw.FontWeight.bold),
        ),
        pw.Text(invoice.notes ?? '', fontSize: 10),
      ],

      // Payment status
      pw.SizedBox(height: 12),
      if (invoice.isPaid)
        pw.Container(
          padding: const pw.EdgeInsets.all(12),
          decoration: pw.BoxDecoration(
            color: PdfColors.green.withOpacity(0.1),
            border: pw.Border.all(color: PdfColors.green, width: 2),
          ),
          child: pw.Text(
            'PAID',
            style: pw.TextStyle(
              color: PdfColors.green,
              fontSize: 16,
              fontWeight: pw.FontWeight.bold,
            ),
          ),
        ),
    ];
  }
}
